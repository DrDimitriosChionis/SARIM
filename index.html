<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ISRRA-Q | Risk Profile & Action Plan</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Noto+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    :root{
      --bg: #0b1220;
      --panel: #101a2e;
      --card: #0f2233;
      --muted: rgba(255,255,255,.70);
      --text: rgba(255,255,255,.95);
      --accent: #4fd1c5;
      --accent2: #60a5fa;
      --warn: #f59e0b;
      --bad: #fb7185;
      --ok: #34d399;
      --radius: 16px;
    }

    *{ box-sizing: border-box; }
    html,body{ height: 100%; }
    body{
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: Inter, "Noto Sans", system-ui, sans-serif;
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* --- HERO --- */
    .hero-screen {
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: radial-gradient(circle at 50% 30%, #1a2c4e 0%, #0b1220 70%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      text-align: center;
      transition: opacity 0.5s ease;
    }
    .hero-screen.closed { opacity: 0; pointer-events: none; }
    
    .hero-content { max-width: 600px; animation: fadeIn 1s ease-out; }
    .hero-title {
      font-size: 2.5rem; font-weight: 800;
      background: linear-gradient(135deg, #4fd1c5, #60a5fa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin: 0 0 20px;
    }
    .hero-btn {
      background: var(--accent); color: #000; border: none;
      padding: 16px 40px; font-size: 1.1rem; font-weight: 700;
      border-radius: 50px; cursor: pointer;
      box-shadow: 0 0 20px rgba(79,209,197,0.4);
      transition: transform 0.2s;
    }
    .hero-btn:hover { transform: scale(1.05); }
    
    .hero-lang-btn {
      position: absolute; top: 20px; right: 20px;
      background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
      color: white; padding: 8px 16px; border-radius: 20px;
      cursor: pointer;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    /* --- APP LAYOUT --- */
    .wrap{
      max-width: 800px; margin: 0 auto; padding: 20px 16px 100px;
      display: none; opacity: 0; transition: opacity 1s ease;
    }
    .wrap.visible { display: block; opacity: 1; }

    header {
      background: rgba(16,26,46,.95); border: 1px solid rgba(255,255,255,.1);
      border-radius: var(--radius); padding: 20px; margin-bottom: 25px;
      display: flex; flex-direction: column; gap: 15px;
    }
    
    .top-bar { display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 10px; }
    .brand h1 { font-size: 1.2rem; margin: 0; color: var(--accent); }
    
    .header-btns { display: flex; gap: 8px; }
    .btn-small {
      background: rgba(255,255,255,.1); border: none; color: white;
      padding: 6px 12px; border-radius: 8px; cursor: pointer; font-size: 0.8rem;
    }
    
    .progress-bar { height: 6px; background: rgba(255,255,255,.1); border-radius: 10px; overflow: hidden; }
    .fill { height: 100%; width: 0%; background: var(--accent); transition: width 0.3s; }
    .prog-text { font-size: 0.75rem; color: var(--muted); margin-top: 4px; display: block; text-align: right; }

    /* --- QUESTIONS --- */
    .dims-container { display: flex; flex-direction: column; gap: 30px; }
    
    .dim-block {
      background: var(--panel); border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--radius); padding: 20px;
    }
    .dim-header {
      border-bottom: 1px solid rgba(255,255,255,.1); padding-bottom: 10px; margin-bottom: 15px;
    }
    .dim-title { font-size: 1.1rem; font-weight: 700; color: var(--accent2); margin: 0; }
    .dim-desc { font-size: 0.9rem; color: var(--muted); margin: 4px 0 0; }

    .item-row { margin-bottom: 20px; }
    .q-text { font-size: 0.95rem; margin-bottom: 8px; display: block; }
    .required-mark { color: var(--bad); margin-left: 4px; }

    .likert-scale { display: flex; gap: 2px; justify-content: space-between; }
    .likert-opt { 
      flex: 1; text-align: center; cursor: pointer; 
      background: rgba(255,255,255,.05); border-radius: 6px; padding: 10px 0;
      transition: 0.2s; position: relative;
    }
    .likert-opt:hover { background: rgba(255,255,255,.12); }
    
    .likert-opt input { position: absolute; opacity: 0; cursor: pointer; }
    .likert-val { font-weight: 600; font-size: 0.9rem; color: var(--muted); }
    
    /* Checked State */
    .likert-opt:has(input:checked) {
      background: var(--accent); color: #000; box-shadow: 0 0 10px rgba(79,209,197,0.4);
    }
    .likert-opt:has(input:checked) .likert-val { color: #000; }

    .anchors { display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--muted); margin-top: 6px; padding: 0 4px; }

    /* --- BOTTOM ACTION --- */
    .bottom-action {
      margin-top: 40px; padding: 30px; text-align: center;
      background: var(--card); border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,.1);
    }
    .calc-btn {
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: #000; border: none; padding: 15px 50px;
      font-size: 1.1rem; font-weight: 800; border-radius: 12px;
      cursor: pointer; transition: transform 0.2s;
    }
    .calc-btn:hover { transform: scale(1.02); box-shadow: 0 0 20px rgba(79,209,197,0.4); }

    /* --- RESULTS & PRINT AREA --- */
    .results-section { display: none; margin-top: 40px; }
    .results-section.show { display: block; animation: slideUp 0.6s ease; }

    .input-area { background: var(--panel); padding: 20px; border-radius: var(--radius); margin-bottom: 20px; border: 1px solid var(--accent); }
    .email-input {
      width: 100%; padding: 12px; border-radius: 8px; margin-top: 8px;
      background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,.3); color: white;
    }

    /* Print Container styling for PDF */
    #printContainer {
      background: #fff; color: #000; /* Force white bg for PDF */
      padding: 30px; border-radius: 4px;
      display: none; /* Hidden until calc, but displayed during PDF gen */
    }
    /* When results are shown, we display the print container but styled for screen */
    .results-section.show #printContainer {
      display: block;
      background: #f0f4f8; /* Light grey for screen */
      color: #1a2c4e;
    }

    /* Internal Print Elements */
    .print-header { border-bottom: 2px solid #1a2c4e; padding-bottom: 10px; margin-bottom: 20px; }
    .print-logo { font-size: 1.5rem; font-weight: 800; color: #1a2c4e; }
    
    .profile-summary {
      background: #e6fffa; border: 1px solid #4fd1c5;
      padding: 20px; border-radius: 12px; margin-bottom: 20px;
    }
    .profile-code-display { font-size: 2rem; font-family: monospace; font-weight: 700; color: #0d9488; }
    .profile-title-display { font-size: 1.2rem; font-weight: 700; margin-bottom: 10px; }
    .profile-text { font-style: italic; color: #333; line-height: 1.5; font-size: 0.95rem; }

    .kpi-table { width: 100%; border-collapse: collapse; margin-bottom: 25px; }
    .kpi-table th { text-align: left; border-bottom: 2px solid #ccc; padding: 8px; font-size: 0.8rem; text-transform: uppercase; }
    .kpi-table td { border-bottom: 1px solid #eee; padding: 8px; }
    .tag-h { background: #d1fae5; color: #065f46; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; }
    .tag-l { background: #ffe4e6; color: #9f1239; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; }

    .plan-box { background: #fff; border: 1px solid #ccc; padding: 15px; border-radius: 8px; }
    .plan-lines { white-space: pre-line; line-height: 1.6; font-size: 0.95rem; }

    .export-btns { display: flex; gap: 10px; margin-top: 20px; }
    .exp-btn {
      flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: 700;
      background: #fff; color: #0b1220; transition: 0.2s;
    }
    .exp-btn.primary { background: var(--accent); color: #000; }
    .exp-btn:hover { opacity: 0.9; }

    @keyframes slideUp { from { transform: translateY(40px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
  </style>
</head>

<body>

<div class="hero-screen" id="hero">
  <button class="hero-lang-btn" id="heroLangBtn">English</button>
  <div class="hero-content">
    <h1 class="hero-title" id="h_title">Το Ρίσκο είναι Αφήγηση</h1>
    <p style="color:rgba(255,255,255,0.8); margin-bottom:30px; font-size:1.1rem;" id="h_text">
      Ανακαλύψτε το προφίλ σας στη λήψη αποφάσεων υπό πίεση. 
      <br>Συμπληρώστε το ερωτηματολόγιο και λάβετε το προσωπικό σας πλάνο δράσης.
    </p>
    <button class="hero-btn" id="startBtn">START</button>
  </div>
</div>

<div class="wrap" id="appWrap">
  
  <header>
    <div class="top-bar">
      <div class="brand">
        <h1>ISRRA-Q</h1>
        <small id="subTitle">Risk Perception & Action</small>
      </div>
      <div class="header-btns">
        <button class="btn-small" id="toggleLang">EN/GR</button>
        <button class="btn-small" id="resetBtn">Reset</button>
      </div>
    </div>
    <div>
      <div class="progress-bar"><div class="fill" id="bar"></div></div>
      <span class="prog-text" id="progTxt">0/50 Answered</span>
    </div>
  </header>

  <div class="dims-container" id="quizContainer">
    </div>

  <div class="bottom-action">
    <button class="calc-btn" id="calcBtn">Υπολογισμός & Προβολή</button>
    <p style="color:var(--bad); display:none; margin-top:10px;" id="errorMsg"></p>
  </div>

  <div class="results-section" id="resultsSection">
    
    <div class="input-area no-print">
      <h3 style="margin-top:0;">Ολοκλήρωση</h3>
      <label for="userEmail" style="font-size:0.9rem; color:var(--muted);">Email (για το PDF):</label>
      <input type="email" id="userEmail" class="email-input" placeholder="example@email.com">
    </div>

    <div id="printContainer">
      
      <div class="print-header">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <span class="print-logo">ISRRA-Q Report</span>
          <span style="font-size:0.8rem; color:#666;" id="printDate">Date</span>
        </div>
        <div style="font-size:0.9rem; color:#444;">User: <span id="printEmailDisplay"></span></div>
      </div>

      <div class="profile-summary">
        <div class="profile-code-display" id="resCode">-----</div>
        <div class="profile-title-display" id="resName">Profile Name</div>
        <hr style="border:0; border-top:1px solid #4fd1c5; margin:10px 0; opacity:0.3;">
        <div class="profile-text" id="resExpl">
          </div>
      </div>

      <div style="margin-bottom:20px;">
        <h4 style="margin:0 0 10px 0; text-transform:uppercase; font-size:0.85rem; letter-spacing:1px;">Scores & Dimensions</h4>
        <table class="kpi-table">
          <thead>
            <tr>
              <th>Dimension</th>
              <th>Score</th>
              <th>State</th>
            </tr>
          </thead>
          <tbody id="kpiBody"></tbody>
        </table>
      </div>

      <div class="plan-box">
        <h4 style="margin-top:0; color:#0b1220;">SARIM Micro-Plan (14 Days)</h4>
        <div class="plan-lines" id="planText"></div>
      </div>

    </div>

    <div class="export-btns no-print">
      <button class="exp-btn primary" id="pdfBtn">Download PDF</button>
      <button class="exp-btn" id="wordBtn">Download Word</button>
    </div>

  </div>

</div>

<script>
  /* --- CONTENT DATA --- */
  const DIM = [
    { key:"F", en:"Risk Framing", gr:"Πλαισίωση Ρίσκου", dEn:"How you perceive threat vs challenge.", dGr:"Πώς αντιλαμβάνεσαι την απειλή έναντι της πρόκλησης." },
    { key:"E", en:"Cognitive Filtering", gr:"Συναισθηματικό Φίλτρο", dEn:"Impact of stress on judgement.", dGr:"Η επίδραση του στρες στην κρίση." },
    { key:"C", en:"Communication", gr:"Επικοινωνία", dEn:"Clarity and signal transmission.", dGr:"Σαφήνεια και μετάδοση σήματος." },
    { key:"A", en:"Action", gr:"Δράση", dEn:"Moving from thought to deed.", dGr:"Από τη σκέψη στην πράξη." },
    { key:"S", en:"Safety Culture", gr:"Κουλτούρα Ασφάλειας", dEn:"Shared responsibility and speak-up.", dGr:"Συλλογική ευθύνη και αναφορά." },
  ];

  const ITEMS = {
    F: [
       {en:"I tend to view risk as a challenge rather than a threat.", gr:"Τείνω να βλέπω το ρίσκο ως πρόκληση και όχι ως απειλή."},
       {en:"When faced with uncertainty, I try to make sense of the situation before acting.", gr:"Όταν υπάρχει αβεβαιότητα, προσπαθώ πρώτα να καταλάβω την κατάσταση και μετά να δράσω."},
       {en:"I usually relate risky situations to personal failure.", gr:"Συνήθως συνδέω τις ριψοκίνδυνες καταστάσεις με προσωπική αποτυχία."}, // R
       {en:"I can reframe negative events into opportunities for strategic learning.", gr:"Μπορώ να ξαναπλαισιώσω αρνητικά γεγονότα ως ευκαιρίες για στρατηγική μάθηση."},
       {en:"I often get stuck in a single narrative when thinking about risk.", gr:"Συχνά κολλάω σε μία μόνο αφήγηση όταν σκέφτομαι το ρίσκο."}, // R
       {en:"The way I talk about risk influences how others perceive it.", gr:"Ο τρόπος που μιλάω για το ρίσκο επηρεάζει το πώς το αντιλαμβάνονται οι άλλοι."},
       {en:"I consciously shape the story I tell myself about danger or uncertainty.", gr:"Συνειδητά διαμορφώνω την ιστορία που λέω στον εαυτό μου για κίνδυνο ή αβεβαιότητα."},
       {en:"I believe that the framing of a problem determines its possible solutions.", gr:"Πιστεύω ότι η πλαισίωση ενός προβλήματος καθορίζει τις πιθανές λύσεις."},
       {en:"I use language that normalises uncertainty when I explain risks to others.", gr:"Χρησιμοποιώ γλώσσα που κανονικοποιεί την αβεβαιότητα όταν εξηγώ ρίσκα σε άλλους."},
       {en:"I experience risk as an open ended experience, not something strictly positive or negative.", gr:"Βιώνω το ρίσκο ως μια ανοιχτή εμπειρία και όχι ως κάτι αυστηρά θετικό ή αρνητικό."},
    ],
    E: [
       {en:"My emotions interfere with how accurately I assess risk.", gr:"Τα συναισθήματά μου παρεμβαίνουν στο πόσο ακριβώς εκτιμώ το ρίσκο."}, // R
       {en:"I remain calm and analytical when faced with high pressure situations.", gr:"Παραμένω ήρεμος και αναλυτικός όταν αντιμετωπίζω καταστάσεις υψηλής πίεσης."},
       {en:"I tend to exaggerate potential negative outcomes when under stress.", gr:"Τείνω να υπερβάλλω τις πιθανές αρνητικές εκβάσεις όταν είμαι υπό στρες."}, // R
       {en:"I can recognise when fear is distorting my perception of risk.", gr:"Μπορώ να αναγνωρίσω όταν ο φόβος αλλοιώνει την αντίληψή μου για το ρίσκο."},
       {en:"I often assume the worst even when evidence is lacking.", gr:"Συχνά υποθέτω το χειρότερο, ακόμη και όταν λείπουν στοιχεία."}, // R
       {en:"I notice how my mood shifts the way I interpret threats.", gr:"Παρατηρώ πώς η διάθεσή μου αλλάζει τον τρόπο που ερμηνεύω απειλές."},
       {en:"I regulate my emotional response before making risk related decisions.", gr:"Ρυθμίζω τη συναισθηματική μου αντίδραση πριν πάρω αποφάσεις σχετικές με ρίσκο."},
       {en:"I struggle to separate personal feelings from objective assessment.", gr:"Δυσκολεύομαι να ξεχωρίσω προσωπικά συναισθήματα από αντικειμενική εκτίμηση."}, // R
       {en:"I feel confident in my ability to assess risk clearly under pressure.", gr:"Νιώθω σίγουρος ότι μπορώ να εκτιμώ καθαρά το ρίσκο υπό πίεση."},
       {en:"I use mental strategies to avoid overreacting in uncertain situations.", gr:"Χρησιμοποιώ νοητικές στρατηγικές για να αποφεύγω την υπεραντίδραση σε καταστάσεις αβεβαιότητας."},
    ],
    C: [
       {en:"I know how to communicate risk without causing panic.", gr:"Ξέρω πώς να επικοινωνώ το ρίσκο χωρίς να προκαλώ πανικό."},
       {en:"I adapt my message depending on who I’m speaking to in risky situations.", gr:"Προσαρμόζω το μήνυμά μου ανάλογα με το σε ποιον μιλάω σε ριψοκίνδυνες καταστάσεις."},
       {en:"I prefer to avoid discussing risks if they are emotionally charged.", gr:"Προτιμώ να αποφεύγω τη συζήτηση για ρίσκα όταν έχουν έντονο συναισθηματικό φορτίο."}, // R
       {en:"I can clearly explain what makes a situation risky.", gr:"Μπορώ να εξηγήσω καθαρά τι κάνει μια κατάσταση ριψοκίνδυνη."},
       {en:"I often hesitate to express concern about potential dangers.", gr:"Συχνά διστάζω να εκφράσω ανησυχία για πιθανούς κινδύνους."}, // R
       {en:"I structure risk related information to help others act appropriately.", gr:"Δομώ τις πληροφορίες για το ρίσκο ώστε να βοηθώ τους άλλους να δράσουν κατάλληλα."},
       {en:"I use storytelling when communicating risk to others.", gr:"Χρησιμοποιώ αφήγηση όταν επικοινωνώ ρίσκο σε άλλους."},
       {en:"I am confident in my ability to express complex threats in simple terms.", gr:"Νιώθω σίγουρος ότι μπορώ να εξηγώ σύνθετες απειλές με απλούς όρους."},
       {en:"I avoid downplaying or exaggerating risk when talking to others.", gr:"Αποφεύγω να υποβαθμίζω ή να υπερβάλλω το ρίσκο όταν μιλάω σε άλλους."},
       {en:"I communicate risks in a way that encourages responsible action.", gr:"Επικοινωνώ τα ρίσκα με τρόπο που ενθαρρύνει υπεύθυνη δράση."},
    ],
    A: [
       {en:"When I sense risk, I take action quickly and deliberately.", gr:"Όταν αντιλαμβάνομαι ρίσκο, δρω γρήγορα και σκόπιμα."},
       {en:"I often know what to do, but delay action due to uncertainty.", gr:"Συχνά ξέρω τι πρέπει να κάνω, αλλά καθυστερώ λόγω αβεβαιότητας."}, // R
       {en:"I act in alignment with what I understand about the situation's risk.", gr:"Δρω σε ευθυγράμμιση με αυτά που καταλαβαίνω για το ρίσκο της κατάστασης."},
       {en:"I adapt my behaviour based on my assessment of threats.", gr:"Προσαρμόζω τη συμπεριφορά μου με βάση την εκτίμησή μου για τις απειλές."},
       {en:"I feel paralysed when I encounter situations involving uncertainty.", gr:"Νιώθω παράλυση όταν αντιμετωπίζω καταστάσεις με αβεβαιότητα."}, // R
       {en:"I follow through with planned actions even under pressure.", gr:"Ολοκληρώνω τις προγραμματισμένες ενέργειες ακόμη και υπό πίεση."},
       {en:"I take steps to mitigate risk rather than ignore it.", gr:"Κάνω βήματα για να μετριάσω το ρίσκο, αντί να το αγνοώ."},
       {en:"I find it easy to operationalise my thoughts into concrete behaviours.", gr:"Μου είναι εύκολο να μετατρέπω τις σκέψεις μου σε συγκεκριμένες συμπεριφορές."},
       {en:"I respond to emerging threats in a methodical and structured way.", gr:"Απαντώ σε αναδυόμενες απειλές με μεθοδικό και δομημένο τρόπο."},
       {en:"I often fail to implement what I know should be done in risky situations.", gr:"Συχνά αποτυγχάνω να εφαρμόσω αυτό που ξέρω ότι πρέπει να γίνει σε ριψοκίνδυνες καταστάσεις."}, // R
    ],
    S: [
       {en:"I feel responsible for contributing to the safety of my team.", gr:"Νιώθω υπεύθυνος να συμβάλλω στην ασφάλεια της ομάδας μου."},
       {en:"I often stay silent about safety concerns to avoid conflict.", gr:"Συχνά μένω σιωπηλός για θέματα ασφάλειας, για να αποφύγω σύγκρουση."}, // R
       {en:"I believe my input on safety matters is valued in my environment.", gr:"Πιστεύω ότι η γνώμη μου για θέματα ασφάλειας εκτιμάται στο περιβάλλον μου."},
       {en:"I act in ways that support a shared culture of responsibility.", gr:"Λειτουργώ με τρόπους που στηρίζουν μια κοινή κουλτούρα ευθύνης."},
       {en:"I feel disconnected from how safety is managed around me.", gr:"Νιώθω αποσυνδεδεμένος από το πώς διαχειρίζεται η ασφάλεια γύρω μου."}, // R
       {en:"I encourage others to speak up when they notice risk.", gr:"Ενθαρρύνω τους άλλους να μιλήσουν όταν παρατηρούν ρίσκο."},
       {en:"I see myself as part of the broader safety system, not just an individual.", gr:"Βλέπω τον εαυτό μου ως μέρος του ευρύτερου συστήματος ασφάλειας και όχι μόνο ως άτομο."},
       {en:"I take initiative to improve how my group handles risky situations.", gr:"Παίρνω πρωτοβουλία για να βελτιώσω το πώς η ομάδα μου χειρίζεται ριψοκίνδυνες καταστάσεις."},
       {en:"I trust that if I report a problem, it will be taken seriously.", gr:"Εμπιστεύομαι ότι αν αναφέρω ένα πρόβλημα, θα ληφθεί σοβαρά υπόψη."},
       {en:"I feel that my values align with the safety culture of my workplace team.", gr:"Νιώθω ότι οι αξίες μου ευθυγραμμίζονται με την κουλτούρα ασφάλειας του χώρου ή της ομάδας μου."},
    ]
  };

  const REVERSE = { F:[3,5], E:[1,3,5,8], C:[3,5], A:[2,5,10], S:[2,5] };
  
  const TEXT = {
    el: {
      hTitle:"Το Ρίσκο είναι Αφήγηση", hText:"Ανακαλύψτε το προφίλ σας και λάβετε πλάνο δράσης.", start:"ΕΚΚΙΝΗΣΗ", hBtn:"English",
      sub:"Risk Profile & Action", calc:"Υπολογισμός & Προβολή", reset:"Reset",
      prog:"απαντήθηκαν", miss:"Πρέπει να απαντήσετε ΟΛΕΣ τις ερωτήσεις για να προχωρήσετε.",
      ancL:"Διαφωνώ", ancR:"Συμφωνώ",
      resH:"Υψηλό", resL:"Χαμηλό",
      interpTitle: "Ερμηνεία Προφίλ",
      hiddenRisk: "Κρυφό Κόστος:",
      managerTip: "Συμβουλή Διαχείρισης:",
      pdfBtn: "Λήψη PDF", wordBtn: "Λήψη Word",
      emailPh: "Συμπληρώστε email για την αναφορά"
    },
    en: {
      hTitle:"Risk is a Narrative", hText:"Discover your profile and get an action plan.", start:"START", hBtn:"Ελληνικά",
      sub:"Risk Profile & Action", calc:"Calculate & View", reset:"Reset",
      prog:"answered", miss:"You must answer ALL questions to proceed.",
      ancL:"Disagree", ancR:"Agree",
      resH:"High", resL:"Low",
      interpTitle: "Profile Interpretation",
      hiddenRisk: "Hidden Cost:",
      managerTip: "Management Tip:",
      pdfBtn: "Download PDF", wordBtn: "Download Word",
      emailPh: "Enter email for the report"
    }
  };

  /* --- RICH INTERPRETATION DATA --- */
  const INTERP = {
    F: { 
      H: { el:"Βλέπεις το ρίσκο ως ευκαιρία μάθησης.", en:"You view risk as a learning opportunity." },
      L: { el:"Βλέπεις το ρίσκο ως απειλή.", en:"You view risk as a threat." }
    },
    E: { 
      H: { el:"Διατηρείς ψυχραιμία υπό πίεση.", en:"You stay calm under pressure." },
      L: { el:"Το στρες επηρεάζει την κρίση σου.", en:"Stress affects your judgement." }
    },
    C: { 
      H: { el:"Επικοινωνείς με σαφήνεια.", en:"You communicate clearly." },
      L: { el:"Διστάζεις να μιλήσεις ανοιχτά.", en:"You hesitate to speak up." }
    },
    A: { 
      H: { el:"Αναλαμβάνεις δράση άμεσα.", en:"You take action immediately." },
      L: { el:"Παραλύεις μπροστά στην αβεβαιότητα.", en:"You freeze in uncertainty." }
    },
    S: { 
      H: { el:"Λειτουργείς ομαδικά.", en:"You act as a team player." },
      L: { el:"Λειτουργείς ατομικά.", en:"You act individually." }
    }
  };

  /* --- APP STATE --- */
  let curLang = "el";
  const answers = JSON.parse(localStorage.getItem("isrra_ans_v3") || "{}");

  function init(){
    renderHero();
    renderQuiz();
    updateProgress();
    applyLang(curLang);
  }

  /* --- HERO & LANG --- */
  function renderHero(){
    const hero = document.getElementById("hero");
    document.getElementById("startBtn").onclick = () => {
      hero.classList.add("closed");
      setTimeout(()=>{ 
        hero.style.display="none"; 
        document.getElementById("appWrap").classList.add("visible");
      }, 500);
    };
    document.getElementById("heroLangBtn").onclick = toggleLang;
    document.getElementById("toggleLang").onclick = toggleLang;
  }

  function toggleLang(){
    curLang = curLang==="el"?"en":"el";
    applyLang(curLang);
  }

  function applyLang(l){
    const t = TEXT[l];
    document.documentElement.lang = l;
    
    document.getElementById("h_title").textContent = t.hTitle;
    document.getElementById("h_text").textContent = t.hText;
    document.getElementById("startBtn").textContent = t.start;
    document.getElementById("heroLangBtn").textContent = t.hBtn;
    
    document.getElementById("subTitle").textContent = t.sub;
    document.getElementById("calcBtn").textContent = t.calc;
    document.getElementById("resetBtn").textContent = t.reset;
    document.getElementById("pdfBtn").textContent = t.pdfBtn;
    document.getElementById("wordBtn").textContent = t.wordBtn;
    document.getElementById("userEmail").placeholder = t.emailPh;
    
    // Rerender questions to update text
    renderQuiz();
  }

  /* --- RENDER QUIZ (Vertical Blocks) --- */
  function renderQuiz(){
    const con = document.getElementById("quizContainer");
    con.innerHTML = "";
    
    DIM.forEach(d => {
      const block = document.createElement("div");
      block.className = "dim-block";
      
      const head = document.createElement("div");
      head.className = "dim-header";
      head.innerHTML = `
        <h3 class="dim-title">${curLang==='el'?d.gr:d.en} (${d.key})</h3>
        <p class="dim-desc">${curLang==='el'?d.dGr:d.dEn}</p>
      `;
      block.appendChild(head);

      const items = ITEMS[d.key];
      items.forEach((it, idx) => {
        const qid = `${d.key}_${idx+1}`;
        const row = document.createElement("div");
        row.className = "item-row";
        
        // Check if answered for mandatory mark (optional visual cue)
        const isAns = answers[qid] !== undefined;
        
        row.innerHTML = `<span class="q-text">
          <strong>${idx+1}.</strong> ${curLang==='el'?it.gr:it.en}
          <span class="required-mark">*</span>
        </span>`;
        
        const likert = document.createElement("div");
        likert.className = "likert-scale";
        
        [1,2,3,4,5,6,7].forEach(val => {
          const opt = document.createElement("label");
          opt.className = "likert-opt";
          const chk = (answers[qid] === val) ? "checked" : "";
          
          opt.innerHTML = `
            <input type="radio" name="${qid}" value="${val}" ${chk}>
            <span class="likert-val">${val}</span>
          `;
          
          opt.querySelector("input").addEventListener("change", (e)=>{
            answers[qid] = parseInt(e.target.value);
            localStorage.setItem("isrra_ans_v3", JSON.stringify(answers));
            updateProgress();
          });
          likert.appendChild(opt);
        });

        row.appendChild(likert);
        
        const anchorDiv = document.createElement("div");
        anchorDiv.className = "anchors";
        anchorDiv.innerHTML = `<span>${TEXT[curLang].ancL}</span><span>${TEXT[curLang].ancR}</span>`;
        row.appendChild(anchorDiv);

        block.appendChild(row);
      });
      
      con.appendChild(block);
    });
  }

  function updateProgress(){
    const done = Object.keys(answers).length;
    const total = 50;
    const pct = Math.round((done/total)*100);
    document.getElementById("bar").style.width = pct+"%";
    document.getElementById("progTxt").textContent = `${done}/${total} ${TEXT[curLang].prog}`;
  }

  /* --- CALCULATION & INTERPRETATION --- */
  document.getElementById("calcBtn").onclick = () => {
    const done = Object.keys(answers).length;
    const err = document.getElementById("errorMsg");
    if(done < 50){
      err.style.display = "block";
      err.textContent = TEXT[curLang].miss;
      return;
    }
    err.style.display = "none";
    
    // Calculate
    const scores = {};
    const states = {};
    DIM.forEach(d => {
      let sum = 0;
      for(let i=1; i<=10; i++){
        let v = answers[`${d.key}_${i}`];
        if(REVERSE[d.key].includes(i)) v = 8 - v;
        sum += v;
      }
      scores[d.key] = sum/10;
      states[d.key] = (sum/10) >= 4.0 ? "H" : "L";
    });

    // Generate Outputs
    const code = DIM.map(d => states[d.key]==="H"?d.key:d.key.toLowerCase()).join("");
    document.getElementById("resCode").textContent = code;
    
    // Name construction
    const sS = states.S==="H" ? (curLang==='el'?"Ομαδικός":"Team") : (curLang==='el'?"Ατομικός":"Solo");
    const sF = states.F==="H" ? (curLang==='el'?"Στρατηγικός":"Strategic") : (curLang==='el'?"Αμυντικός":"Defensive");
    document.getElementById("resName").textContent = `${sS}, ${sF}`;

    // Rich Interpretation
    let explHTML = "";
    DIM.forEach(d => {
      const st = states[d.key];
      const txt = INTERP[d.key][st][curLang];
      explHTML += `<strong>${d.key}:</strong> ${txt} `;
    });
    // Add "Hidden Cost" logic based on lowest score
    let minKey = "F"; let minVal = 10;
    Object.entries(scores).forEach(([k,v])=>{ if(v<minVal){ minVal=v; minKey=k; } });
    
    const hiddenMap = {
      F: {el:"Δυσκολία προσαρμογής σε αλλαγές.", en:"Difficulty adapting to change."},
      E: {el:"Πιθανά λάθη λόγω άγχους.", en:"Potential errors due to anxiety."},
      C: {el:"Παρεξηγήσεις στην ομάδα.", en:"Team misunderstandings."},
      A: {el:"Καθυστερήσεις στην εκτέλεση.", en:"Execution delays."},
      S: {el:"Έλλειψη αναφορών ασφαλείας.", en:"Lack of safety reporting."}
    };
    
    explHTML += `<br><br><strong>${TEXT[curLang].hiddenRisk}</strong> ${hiddenMap[minKey][curLang]}`;
    document.getElementById("resExpl").innerHTML = explHTML;

    // Table
    const tbody = document.getElementById("kpiBody");
    tbody.innerHTML = "";
    DIM.forEach(d => {
      const st = states[d.key];
      const cls = st==="H"?"tag-h":"tag-l";
      const lbl = st==="H"?TEXT[curLang].resH:TEXT[curLang].resL;
      const row = `<tr>
        <td>${curLang==='el'?d.gr:d.en}</td>
        <td>${scores[d.key].toFixed(1)}</td>
        <td><span class="${cls}">${lbl}</span></td>
      </tr>`;
      tbody.innerHTML += row;
    });

    // Plan
    const plan = curLang==='el' 
      ? "1. Καταγραφή: Για 3 μέρες σημείωσε τι σε δυσκόλεψε.\n2. Μικρή Αλλαγή: Διάλεξε τη διάσταση με το χαμηλότερο σκορ και κάνε μία ενέργεια.\n3. Feedback: Ρώτα έναν συνάδελφο πώς σε βλέπει."
      : "1. Log: For 3 days note what challenged you.\n2. Small Shift: Pick your lowest score dimension and do one action.\n3. Feedback: Ask a peer for perspective.";
    document.getElementById("planText").textContent = plan;

    // Show
    document.getElementById("resultsSection").classList.add("show");
    setTimeout(()=> document.getElementById("resultsSection").scrollIntoView({behavior:"smooth"}), 200);
  };

  document.getElementById("resetBtn").onclick = () => {
    if(confirm("Reset all?")) { localStorage.removeItem("isrra_ans_v3"); location.reload(); }
  };

  /* --- EXPORT --- */
  document.getElementById("pdfBtn").onclick = () => {
    const el = document.getElementById("printContainer");
    const email = document.getElementById("userEmail").value || "user";
    
    document.getElementById("printDate").textContent = new Date().toLocaleDateString();
    document.getElementById("printEmailDisplay").textContent = email;

    const opt = {
      margin: 10,
      filename: `ISRRA_${email}.pdf`,
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };
    // Element is visible now, so html2pdf should grab it
    html2pdf().set(opt).from(el).save();
  };

  document.getElementById("wordBtn").onclick = () => {
    const content = document.getElementById("printContainer").innerHTML;
    const email = document.getElementById("userEmail").value || "user";
    const header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word'><head><meta charset='utf-8'></head><body>";
    const footer = "</body></html>";
    const sourceHTML = header + content + footer;
    
    const source = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(sourceHTML);
    const link = document.createElement("a");
    document.body.appendChild(link);
    link.href = source;
    link.download = `ISRRA_${email}.doc`;
    link.click();
    document.body.removeChild(link);
  };

  init();
</script>
</body>
</html>
